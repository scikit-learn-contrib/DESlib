language: python
python:
  - "3.5"
  - "3.6"
install:
  - wget https://repo.anaconda.com/archive/Anaconda3-5.2.0-Linux-x86_64.sh -O anaconda.sh
  - bash anaconda.sh -b -p $HOME/anaconda
  - export PATH="$HOME/anaconda/bin:$PATH"
  - hash -r
  - conda create -n test_env python="$TRAVIS_PYTHON_VERSION"
  - conda activate test_env
  - travis_wait travis_retry pip install -r requirements-dev.txt
  - travis_retry pip install codecov
  - travis_retry python setup.py build
  - travis_retry python setup.py install
  - travis_retry conda install faiss-cpu -c pytorch
script: coverage run -m py.test
after_success:
  - codecov
cache:
  - directories:
    - $HOME/.cache/pip
